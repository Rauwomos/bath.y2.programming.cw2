merge_sort([],[]).     % empty list is already sorted
merge_sort([X],[X]).   % single element list is already sorted
merge_sort(List,Sorted):-
    List=[_,_|_],divide(List,L1,L2),     % list with at least two elements is divided into two parts
	merge_sort(L1,Sorted1),merge_sort(L2,Sorted2),  % then each part is sorted
	merge(Sorted1,Sorted2,Sorted).                  % and sorted parts are merged
merge([],L,L).
merge(L,[],L):-L\=[].
merge([X|T1],[Y|T2],[X|T]):-X=<Y,merge(T1,[Y|T2],T).
merge([X|T1],[Y|T2],[Y|T]):-X>Y,merge([X|T1],T2,T).

divide(L,L1,L2):-hv2(L,L,L1,L2).
   
hv2([],R,[],R).   % for lists of even length
hv2([_],R,[],R).  % for lists of odd length
hv([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_|T],[A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31|L],[A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,A31|L1],R):-hv(T,L,L1,R),!.
hv([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_|T],[A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15|L],[A0,A1,A2,A3,A4,A5,A6,A7,A8,A9,A10,A11,A12,A13,A14,A15|L1],R):-hv(T,L,L1,R),!.
hv([_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_|T],[A0,A1,A2,A3,A4,A5,A6,A7|L],[A0,A1,A2,A3,A4,A5,A6,A7|L1],R):-hv(T,L,L1,R),!.
hv([_,_,_,_,_,_,_,_|T],[A,B,C,D|L],[A,B,C,D|L1],R):-hv(T,L,L1,R),!.
hv([_,_,_,_|T],[A,B|L],[A,B|L1],R):-hv(T,L,L1,R),!.
hv([_,_|T],[X|L],[X|L1],R):-hv(T,L,L1,R),!.


div(L, A, B) :-split(L, L, A, B).

split(B, [], [], B).

split([H|T],[_,_|T1],[H|T2],B):-split(T, T1, T2, B).


mtest(Sorted):-merge_sort([0,8,9,7,8,6,7,5,6,4,5,3,4,2,3,1,2,6,1,0,5,8,4,7,34,76,23,45,86,234,12,34,65,37,96,34,21,43,54,65,76,78,89,90,31,42,35,64,57,68,79,70,8,9,7,8,6,7,5,6,4,5,3,4,2,3,1,2,6,1,0,5,8,4,7,34,76,23,45,86,234,12,34,65,37,96,34,21,43,54,65,76,78,89,90,31,42,35,64,57,68,79,70,8,9,7,8,6,7,5,6,4,5,3,4,2,3,1,2,6,1,0,5,8,4,7,34,76,23,45,86,234,12,34,65,37,96,34,21,43,54,65,76,78,89,90,31,42,35,64,57,68,79,765,37,96,34,21,43,54,65,76,78,89,90,31,42,35,64,57,68,79,70,8,9,7,8,6,7,5,6,4,5,3,4,2,3,1,2,6,1,0,5,8,4,7,34,76,23,45,86,234,12,34,65,37,96,34,21,43,54,65,76,78,8965,37,96,34,21,43,54,65,76,78,89,90,31,42,35,64,57,68,79,70,8,9,7,8,6,7,5,6,4,5,3,4,2,3,1,2,6,1,0,5,8,4,7,34,76,23,45,86,234,12,34,65,37,96,34,21,43,54,65,76,78,89],Sorted),!.
rtest().

split2(L,0,[],L).
split2([X|Xs],N,[X|Ys],Zs) :- N > 0, N1 is N - 1, split2(Xs,N1,Ys,Zs).
